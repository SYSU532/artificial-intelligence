"use strict";
//AStar algorithm
function ArraySwapIndex(arr, indexA, indexB) {
    [arr[indexA], arr[indexB]] = [arr[indexB], arr[indexA]];
}
//Represent each node in the search graph, has reference to its parent
// and children node.
class node {
    constructor(state, currentBlank, parent) {
        this.parent = parent;
        this.state = Object.assign([], state);
        this.blankIndex = currentBlank;
        this.children = [];
        this.value = 0;
    }
    get identifier() {
        return this.state.toString();
    }
    getChildren() {
        if (this.children.length !== 0) {
            return this.children;
        }
        if (this.blankIndex % 3 !== 2) {
            //Blank move right
            let newState = Object.assign([], this.state);
            ArraySwapIndex(newState, this.blankIndex, this.blankIndex + 1);
            this.children.push(new node(newState, this.blankIndex + 1, this));
        }
        if (this.blankIndex % 3 !== 0) {
            //Blank move left
            let newState = Object.assign([], this.state);
            ArraySwapIndex(newState, this.blankIndex, this.blankIndex - 1);
            this.children.push(new node(newState, this.blankIndex - 1, this));
        }
        if (Math.floor(this.blankIndex / 3) !== 0) {
            //Blank move up
            let newState = Object.assign([], this.state);
            ArraySwapIndex(newState, this.blankIndex, this.blankIndex - 3);
            this.children.push(new node(newState, this.blankIndex - 3, this));
        }
        if (Math.floor(this.blankIndex / 3) !== 2) {
            //Blank move down
            let newState = Object.assign([], this.state);
            ArraySwapIndex(newState, this.blankIndex, this.blankIndex + 3);
            this.children.push(new node(newState, this.blankIndex + 3, this));
        }
        return this.children;
    }
}
class searchMethod {
    constructor(initState, currentBlank) {
        this.openTable = [];
        this.closedTable = {};
        this.currentNode = new node(initState, currentBlank, null);
        this.openTable.push(this.currentNode);
        this.next();
        this.totalStep = 0;
    }
    next() {
        if (this.checkResult(this.currentNode.state)) {
            return [this.currentNode.state, this.currentNode.blankIndex];
        }
        this.totalStep++;
        let [newNode, index] = this.getLowestNode();
        while (newNode.identifier in this.closedTable) {
            this.openTable.splice(index, 1);
            [newNode, index] = this.getLowestNode();
        }
        this.openTable.splice(index, 1);
        this.closedTable[newNode.identifier] = newNode;
        this.currentNode = newNode;
        let children = this.currentNode.getChildren();
        for (let child of children) {
            this.addNewOpenNode(child);
        }
        return [newNode.state, newNode.blankIndex];
    }
    runAll() {
        while (true) {
            let [state, blank] = this.next();
            if (this.checkResult(state)) {
                break;
            }
        }
    }
    checkResult(state) {
        for (let i = 0; i < 9; i++) {
            if (state[i] !== i) {
                return false;
            }
        }
        return true;
    }
    get pathToCurrent() {
        let result = [];
        let curr = this.currentNode;
        while (curr !== null) {
            result.unshift(curr);
            curr = curr.parent;
        }
        return result;
    }
    get steps() { return this.totalStep; }
}
class aStarH1 extends searchMethod {
    getLowestNode() {
        return [this.openTable[0], 0];
    }
    addNewOpenNode(newNode) {
        this.openTable.push(newNode);
    }
}
class aStarH2 extends searchMethod {
    getLowestNode() {
        return [this.openTable[0], 0];
    }
    addNewOpenNode(newNode) {
        this.openTable.push(newNode);
    }
}
class bfs extends searchMethod {
    getLowestNode() {
        return [this.openTable[0], 0];
    }
    addNewOpenNode(newNode) {
        if (!(newNode.identifier in this.closedTable)) {
            this.openTable.push(newNode);
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYVN0YXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJhU3Rhci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsaUJBQWlCO0FBRWpCLFNBQVMsY0FBYyxDQUFJLEdBQWEsRUFBRSxNQUFjLEVBQUUsTUFBYztJQUNwRSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztBQUM1RCxDQUFDO0FBRUQsc0VBQXNFO0FBQ3RFLHFCQUFxQjtBQUNyQixNQUFNLElBQUk7SUFNTixZQUFZLEtBQWUsRUFBRSxZQUFvQixFQUFFLE1BQWlCO1FBQ2hFLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxLQUFLLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDdEMsSUFBSSxDQUFDLFVBQVUsR0FBRyxZQUFZLENBQUM7UUFDL0IsSUFBSSxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUM7UUFDbkIsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUM7SUFDbkIsQ0FBQztJQUVELElBQUksVUFBVTtRQUNWLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUNqQyxDQUFDO0lBRU0sV0FBVztRQUNkLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1lBQzVCLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQTtTQUN2QjtRQUNELElBQUksSUFBSSxDQUFDLFVBQVUsR0FBRyxDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQzNCLGtCQUFrQjtZQUNsQixJQUFJLFFBQVEsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDN0MsY0FBYyxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxVQUFVLEdBQUMsQ0FBQyxDQUFDLENBQUM7WUFDN0QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxVQUFVLEdBQUcsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7U0FDckU7UUFDRCxJQUFJLElBQUksQ0FBQyxVQUFVLEdBQUcsQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUMzQixpQkFBaUI7WUFDakIsSUFBSSxRQUFRLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzdDLGNBQWMsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsVUFBVSxHQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzdELElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsVUFBVSxHQUFHLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDO1NBQ3JFO1FBQ0QsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxVQUFVLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQ3ZDLGVBQWU7WUFDZixJQUFJLFFBQVEsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDN0MsY0FBYyxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxVQUFVLEdBQUMsQ0FBQyxDQUFDLENBQUM7WUFDN0QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxVQUFVLEdBQUcsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7U0FDckU7UUFDRCxJ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QUFDO0lBQ2xDLENBQUM7SUFFTSxjQUFjLENBQUMsT0FBYTtRQUMvQixJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsVUFBVSxJQUFJLElBQUksQ0FBQyxXQUFXLENBQUMsRUFBRTtZQUMzQyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztTQUNoQztJQUNMLENBQUM7Q0FDSiIsInNvdXJjZXNDb250ZW50IjpbIi8vQVN0YXIgYWxnb3JpdGhtXG5cbmZ1bmN0aW9uIEFycmF5U3dhcEluZGV4PFQ+KGFycjogQXJyYXk8VD4sIGluZGV4QTogbnVtYmVyLCBpbmRleEI6IG51bWJlcikge1xuICAgIFthcnJbaW5kZXhBXSwgYXJyW2luZGV4Ql1dID0gW2FycltpbmRleEJdLCBhcnJbaW5kZXhBXV07XG59XG5cbi8vUmVwcmVzZW50IGVhY2ggbm9kZSBpbiB0aGUgc2VhcmNoIGdyYXBoLCBoYXMgcmVmZXJlbmNlIHRvIGl0cyBwYXJlbnRcbi8vIGFuZCBjaGlsZHJlbiBub2RlLlxuY2xhc3Mgbm9kZSB7XG4gICAgcHVibGljIHBhcmVudDogbm9kZXxudWxsO1xuICAgIHB1YmxpYyBjaGlsZHJlbjogbm9kZVtdO1xuICAgIHB1YmxpYyBzdGF0ZTogbnVtYmVyW107XG4gICAgcHVibGljIGJsYW5rSW5kZXg6IG51bWJlcjtcbiAgICBwdWJsaWMgdmFsdWU6IG51bWJlcjtcbiAgICBjb25zdHJ1Y3RvcihzdGF0ZTogbnVtYmVyW10sIGN1cnJlbnRCbGFuazogbnVtYmVyLCBwYXJlbnQ6IG5vZGV8bnVsbCkge1xuICAgICAgICB0aGlzLnBhcmVudCA9IHBhcmVudDtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IE9iamVjdC5hc3NpZ24oW10sIHN0YXRlKTtcbiAgICAgICAgdGhpcy5ibGFua0luZGV4ID0gY3VycmVudEJsYW5rO1xuICAgICAgICB0aGlzLmNoaWxkcmVuID0gW107XG4gICAgICAgIHRoaXMudmFsdWUgPSAwO1xuICAgIH1cblxuICAgIGdldCBpZGVudGlmaWVyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS50b1N0cmluZygpO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRDaGlsZHJlbigpOiBub2RlW10ge1xuICAgICAgICBpZiAodGhpcy5jaGlsZHJlbi5sZW5ndGggIT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNoaWxkcmVuXG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuYmxhbmtJbmRleCAlIDMgIT09IDIpIHtcbiAgICAgICAgICAgIC8vQmxhbmsgbW92ZSByaWdodFxuICAgICAgICAgICAgbGV0IG5ld1N0YXRlID0gT2JqZWN0LmFzc2lnbihbXSwgdGhpcy5zdGF0ZSk7XG4gICAgICAgICAgICBBcnJheVN3YXBJbmRleChuZXdTdGF0ZSwgdGhpcy5ibGFua0luZGV4LCB0aGlzLmJsYW5rSW5kZXgrMSk7XG4gICAgICAgICAgICB0aGlzLmNoaWxkcmVuLnB1c2gobmV3IG5vZGUobmV3U3RhdGUsIHRoaXMuYmxhbmtJbmRleCArIDEsIHRoaXMpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5ibGFua0luZGV4ICUgMyAhPT0gMCkge1xuICAgICAgICAgICAgLy9CbGFuayBtb3ZlIGxlZnRcbiAgICAgICAgICAgIGxldCBuZXdTdGF0ZSA9IE9iamVjdC5hc3NpZ24oW10sIHRoaXMuc3RhdGUpO1xuICAgICAgICAgICAgQXJyYXlTd2FwSW5kZXgobmV3U3RhdGUsIHRoaXMuYmxhbmtJbmRleCwgdGhpcy5ibGFua0luZGV4LTEpO1xuICAgICAgICAgICAgdGhpcy5jaGlsZHJlbi5wdXNoKG5ldyBub2RlKG5ld1N0YXRlLCB0aGlzLmJsYW5rSW5kZXggLSAxLCB0aGlzKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKE1hdGguZmxvb3IodGhpcy5ibGFua0luZGV4IC8gMykgIT09IDApIHtcbiAgICAgICAgICAgIC8vQmxhbmsgbW92ZSB1cFxuICAgICAgICAgICAgbGV0IG5ld1N0YXRlID0gT2JqZWN0LmFzc2lnbihbXSwgdGhpcy5zdGF0ZSk7XG4gICAgICAgICAgICBBcnJheVN3YXBJbmRleChuZXdTdGF0ZSwgdGhpcy5ibGFua0luZGV4LCB0aGlzLmJsYW5rSW5kZXgtMyk7XG4gICAgICAgICAgICB0aGlzLmNoaWxkcmVuLnB1c2gobmV3IG5vZGUobmV3U3RhdGUsIHRoaXMuYmxhbmtJbmRleCAtIDMsIHRoaXMpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoTWF0aC5mbG9vcih0aGlzLmJsYW5rSW5kZXggLyAzKSAhPT0gMikge1xuICAgICAgICAgICAgLy9CbGFuayBtb3ZlIGRvd25cbiAgICAgICAgICAgIGxldCBuZXdTdGF0ZSA9IE9iamVjdC5hc3NpZ24oW10sIHRoaXMuc3RhdGUpO1xuICAgICAgICAgICAgQXJyYXlTd2FwSW5kZXgobmV3U3RhdGUsIHRoaXMuYmxhbmtJbmRleCwgdGhpcy5ibGFua0luZGV4KzMpO1xuICAgICAgICAgICAgdGhpcy5jaGlsZHJlbi5wdXNoKG5ldyBub2RlKG5ld1N0YXRlLCB0aGlzLmJsYW5rSW5kZXggKyAzLCB0aGlzKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuY2hpbGRyZW47XG4gICAgfVxufVxuXG5cbmFic3RyYWN0IGNsYXNzIHNlYXJjaE1ldGhvZCB7XG4gICAgcHVibGljIG9wZW5UYWJsZTogbm9kZVtdO1xuICAgIHB1YmxpYyBjbG9zZWRUYWJsZToge1tpZDpzdHJpbmddOiBub2RlfTtcblxuICAgIHB1YmxpYyBjdXJyZW50Tm9kZTogbm9kZTtcbiAgICAvL1RoZSBwYXRoIGZyb20gaW5pdGlhbCBub2RlIHRvIHRoZSBjdXJyZW50IG5vZGVcbiAgICBwcml2YXRlIHRvdGFsU3RlcDogbnVtYmVyO1xuXG4gICAgY29uc3RydWN0b3IoaW5pdFN0YXRlOiBudW1iZXJbXSwgY3VycmVudEJsYW5rOiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5vcGVuVGFibGUgPSBbXTtcbiAgICAgICAgdGhpcy5jbG9zZWRUYWJsZSA9IHt9O1xuICAgICAgICB0aGlzLmN1cnJlbnROb2RlID0gbmV3IG5vZGUoaW5pdFN0YXRlLCBjdXJyZW50QmxhbmssIG51bGwpO1xuICAgICAgICB0aGlzLm9wZW5UYWJsZS5wdXNoKHRoaXMuY3VycmVudE5vZGUpO1xuICAgICAgICB0aGlzLm5leHQoKTtcbiAgICAgICAgdGhpcy50b3RhbFN0ZXAgPSAwO1xuICAgIH1cblxuICAgIHB1YmxpYyBuZXh0KCk6IFtudW1iZXJbXSwgbnVtYmVyXSB7XG4gICAgICAgIGlmICh0aGlzLmNoZWNrUmVzdWx0KHRoaXMuY3VycmVudE5vZGUuc3RhdGUpKSB7XG4gICAgICAgICAgICByZXR1cm4gW3RoaXMuY3VycmVudE5vZGUuc3RhdGUsIHRoaXMuY3VycmVudE5vZGUuYmxhbmtJbmRleF07XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy50b3RhbFN0ZXArKztcbiAgICAgICAgbGV0IFtuZXdOb2RlLCBpbmRleF0gPSB0aGlzLmdldExvd2VzdE5vZGUoKTtcbiAgICAgICAgd2hpbGUgKG5ld05vZGUuaWRlbnRpZmllciBpbiB0aGlzLmNsb3NlZFRhYmxlKSB7XG4gICAgICAgICAgICB0aGlzLm9wZW5UYWJsZS5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgW25ld05vZGUsIGluZGV4XSA9IHRoaXMuZ2V0TG93ZXN0Tm9kZSgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMub3BlblRhYmxlLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIHRoaXMuY2xvc2VkVGFibGVbbmV3Tm9kZS5pZGVudGlmaWVyXSA9IG5ld05vZGU7XG4gICAgICAgIHRoaXMuY3VycmVudE5vZGUgPSBuZXdOb2RlO1xuICAgICAgICBsZXQgY2hpbGRyZW4gPSB0aGlzLmN1cnJlbnROb2RlLmdldENoaWxkcmVuKCk7XG4gICAgICAgIGZvciAobGV0IGNoaWxkIG9mIGNoaWxkcmVuKSB7XG4gICAgICAgICAgICB0aGlzLmFkZE5ld09wZW5Ob2RlKGNoaWxkKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gW25ld05vZGUuc3RhdGUsIG5ld05vZGUuYmxhbmtJbmRleF07XG4gICAgfVxuXG4gICAgcHVibGljIHJ1bkFsbCgpOiBhbnkge1xuICAgICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICAgICAgbGV0IFtzdGF0ZSwgYmxhbmtdID0gdGhpcy5uZXh0KCk7XG4gICAgICAgICAgICBpZiAodGhpcy5jaGVja1Jlc3VsdChzdGF0ZSkpIHtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBjaGVja1Jlc3VsdChzdGF0ZTogbnVtYmVyW10pOiBib29sZWFuIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA5OyBpKyspIHtcbiAgICAgICAgICAgIGlmIChzdGF0ZVtpXSAhPT0gaSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0IHBhdGhUb0N1cnJlbnQoKTogbm9kZVtdIHtcbiAgICAgICAgbGV0IHJlc3VsdDogbm9kZVtdID0gW107XG4gICAgICAgIGxldCBjdXJyOiBub2RlfG51bGwgPSB0aGlzLmN1cnJlbnROb2RlO1xuICAgICAgICB3aGlsZSAoY3VyciAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcmVzdWx0LnVuc2hpZnQoY3Vycik7XG4gICAgICAgICAgICBjdXJyID0gY3Vyci5wYXJlbnQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0IHN0ZXBzKCkgeyByZXR1cm4gdGhpcy50b3RhbFN0ZXA7IH1cblxuICAgIC8vUmV0dXJucyBub2RlIGFuZCBpbmRleCBvZiB0aGUgbm9kZSBpbiBvcGVuIHRhYmxlXG4gICAgcHVibGljIGFic3RyYWN0IGdldExvd2VzdE5vZGUoKTogW25vZGUsIG51bWJlcl07XG5cbiAgICBwdWJsaWMgYWJzdHJhY3QgYWRkTmV3T3Blbk5vZGUobmV3Tm9kZTogbm9kZSk6IHZvaWQ7XG5cbn1cblxuY2xhc3MgYVN0YXJIMSBleHRlbmRzIHNlYXJjaE1ldGhvZHtcblxuICAgIHB1YmxpYyBnZXRMb3dlc3ROb2RlKCk6IFtub2RlLCBudW1iZXJdIHtcbiAgICAgICAgcmV0dXJuIFt0aGlzLm9wZW5UYWJsZVswXSwgMF07XG4gICAgfVxuXG4gICAgcHVibGljIGFkZE5ld09wZW5Ob2RlKG5ld05vZGU6IG5vZGUpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5vcGVuVGFibGUucHVzaChuZXdOb2RlKTtcbiAgICB9XG59XG5cbmNsYXNzIGFTdGFySDIgZXh0ZW5kcyBzZWFyY2hNZXRob2R7XG5cbiAgICBwdWJsaWMgZ2V0TG93ZXN0Tm9kZSgpOiBbbm9kZSwgbnVtYmVyXSB7XG4gICAgICAgIHJldHVybiBbdGhpcy5vcGVuVGFibGVbMF0sIDBdO1xuICAgIH1cblxuICAgIHB1YmxpYyBhZGROZXdPcGVuTm9kZShuZXdOb2RlOiBub2RlKTogdm9pZCB7XG4gICAgICAgIHRoaXMub3BlblRhYmxlLnB1c2gobmV3Tm9kZSk7XG4gICAgfVxufVxuXG5jbGFzcyBiZnMgZXh0ZW5kcyBzZWFyY2hNZXRob2Qge1xuXG4gICAgcHVibGljIGdldExvd2VzdE5vZGUoKTogW25vZGUsIG51bWJlcl0ge1xuICAgICAgICByZXR1cm4gW3RoaXMub3BlblRhYmxlWzBdLCAwXTtcbiAgICB9XG5cbiAgICBwdWJsaWMgYWRkTmV3T3Blbk5vZGUobmV3Tm9kZTogbm9kZSk6IHZvaWQge1xuICAgICAgICBpZiAoIShuZXdOb2RlLmlkZW50aWZpZXIgaW4gdGhpcy5jbG9zZWRUYWJsZSkpIHtcbiAgICAgICAgICAgIHRoaXMub3BlblRhYmxlLnB1c2gobmV3Tm9kZSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbiJdfQ==