"use strict";
/// <reference path="./aStar.ts" />
/// <reference path="./puzzles.d.ts" />
let method;
let runTimeout = -2;
function runBFS() {
    startGame();
    let seq = jqueryElemToNumSeq(pieces);
    method = new bfs(seq, current_blank);
    showInfo();
    addButtons();
    $("#title").text("广度优先算法");
}
function showInfo() {
    $("#open-node").text(method.openTable.length.toString());
    $("#total-step").text(method.steps.toString());
    let lowestNode = method.getLowestNode();
    let lowNodeState = lowestNode.state.slice();
    lowNodeState.forEach(function (_, index) {
        lowNodeState[index] += 1;
    });
    $("#open-row1").text(lowNodeState.slice(0, 3).toString());
    $("#open-row2").text(lowNodeState.slice(3, 6).toString());
    $("#open-row3").text(lowNodeState.slice(6, 9).toString());
}
function runAStarH1() {
    startGame();
    let seq = jqueryElemToNumSeq(pieces);
    method = new aStarH1(seq, current_blank);
    showInfo();
    addButtons();
    $("#title").text("A星算法 H1");
}
function runAStarH2() {
    startGame();
    let seq = jqueryElemToNumSeq(pieces);
    method = new aStarH2(seq, current_blank);
    showInfo();
    addButtons();
    $("#title").text("A星算法 H2");
}
function jqueryElemToNumSeq(arr) {
    let result = [];
    for (var i = 0; i < 9; i++) {
        var className = arr[i].attr("class");
        result.push(Math.abs(className.slice(className.length - 2)));
    }
    return result;
}
function autoRun() {
    try {
        goNext();
    }
    catch (_a) {
        return;
    }
    if (runTimeout !== -2)
        setTimeout(autoRun, 2);
}
function goNext() {
    if (method.checkResult(method.currentNode.state)) {
        runTimeout = -2;
        $("#button-area").append($("<button>").
            attr("id", "showpath").addClass("click").
            click(function () {
            let path = method.pathToCurrent;
            current_blank = path[0].blankIndex;
            printPicture(path[0].state);
            let i = 1;
            setTimeout(function displayPath() {
                pieces[path[i++].blankIndex].moveFunc();
                if (i < path.length) {
                    setTimeout(displayPath, 500);
                }
            }, 500);
        }).text("显示路径"));
        $("#next").remove();
        $("#autorun").remove();
        $("#run-all").remove();
        return;
    }
    let [newSeq, newBlank] = method.next();
    showInfo();
    current_blank = newBlank;
    printPicture(newSeq);
    if (method.checkResult(newSeq)) {
        $("#message").text("搜索完成。步数：" + method.steps + ", 路径长度：" + method.pathToCurrent.length);
    }
}
function addButtons() {
    $("#button-area").append($("<button>").
        attr("id", "autorun").addClass("click").
        click(function () {
        if (runTimeout !== -2) {
            clearTimeout(runTimeout);
            runTimeout = -2;
            $("#next").show();
            $("#run-all").show();
            $(this).text("自动运行");
        }
        else {
            runTimeout = setTimeout(autoRun, 1);
            $(this).text("暂停运行");
            $("#next").hide();
            $("#run-all").hide();
        }
    }).text("自动运行"));
    $("#button-area").append($("<button>").
        attr("id", "run-all").addClass("click").
        click(function () {
        method.runAll();
        current_blank = method.currentNode.blankIndex;
        printPicture(method.currentNode.state);
        $("#message").text("搜索完成。步数：" + method.steps + ", 路径长度：" + method.pathToCurrent.length);
        goNext();
        showInfo();
    }).text("直接求解"));
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYVN0YXJWaWV3LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2FTdGFyVmlldy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsbUNBQW1DO0FBQ25DLHVDQUF1QztBQUV2QyxJQUFJLE1BQW9CLENBQUM7QUFDekIsSUFBSSxVQUFVLEdBQVcsQ0FBQyxDQUFDLENBQUM7QUFFNUIsU0FBUyxNQUFNO0lBQ1gsU0FBUyxFQUFFLENBQUM7SUFDWixJQUFJLEdBQUcsR0FBRyxrQkFBa0IsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNyQyxNQUFNLEdBQUcsSUFBSSxHQUFHLENBQUMsR0FBRyxFQUFFLGFBQWEsQ0FBQyxDQUFDO0lBQ3JDLFFBQVEsRUFBRSxDQUFDO0lBQ1gsVUFBVSxFQUFFLENBQUM7SUFDYixDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFBO0FBQzlCLENBQUM7QUFFRCxTQUFTLFFBQVE7SUFDYixDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUM7SUFDekQsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUM7SUFDL0MsSUFBSSxVQUFVLEdBQUcsTUFBTSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ3hDLElBQUksWUFBWSxHQUFVLFVBQVcsQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDcEQsWUFBWSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsRUFBRSxLQUFLO1FBQ25DLFlBQVksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDN0IsQ0FBQyxDQUFDLENBQUM7SUFDSCxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsQ0FB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Ly8vIDxyZWZlcmVuY2UgcGF0aD1cIi4vYVN0YXIudHNcIiAvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4vcHV6emxlcy5kLnRzXCIgLz5cblxubGV0IG1ldGhvZDogc2VhcmNoTWV0aG9kO1xubGV0IHJ1blRpbWVvdXQ6IG51bWJlciA9IC0yO1xuXG5mdW5jdGlvbiBydW5CRlMoKTogYW55IHtcbiAgICBzdGFydEdhbWUoKTtcbiAgICBsZXQgc2VxID0ganF1ZXJ5RWxlbVRvTnVtU2VxKHBpZWNlcyk7XG4gICAgbWV0aG9kID0gbmV3IGJmcyhzZXEsIGN1cnJlbnRfYmxhbmspO1xuICAgIHNob3dJbmZvKCk7XG4gICAgYWRkQnV0dG9ucygpO1xuICAgICQoXCIjdGl0bGVcIikudGV4dChcIuW5v+W6puS8mOWFiOeul+azlVwiKVxufVxuXG5mdW5jdGlvbiBzaG93SW5mbygpOiBhbnkge1xuICAgICQoXCIjb3Blbi1ub2RlXCIpLnRleHQobWV0aG9kLm9wZW5UYWJsZS5sZW5ndGgudG9TdHJpbmcoKSk7XG4gICAgJChcIiN0b3RhbC1zdGVwXCIpLnRleHQobWV0aG9kLnN0ZXBzLnRvU3RyaW5nKCkpO1xuICAgIGxldCBsb3dlc3ROb2RlID0gbWV0aG9kLmdldExvd2VzdE5vZGUoKTtcbiAgICBsZXQgbG93Tm9kZVN0YXRlID0gKDxub2RlPmxvd2VzdE5vZGUpLnN0YXRlLnNsaWNlKCk7XG4gICAgbG93Tm9kZVN0YXRlLmZvckVhY2goZnVuY3Rpb24gKF8sIGluZGV4KSB7XG4gICAgICAgIGxvd05vZGVTdGF0ZVtpbmRleF0gKz0gMTtcbiAgICB9KTtcbiAgICAkKFwiI29wZW4tcm93MVwiKS50ZXh0KGxvd05vZGVTdGF0ZS5zbGljZSgwLCAzKS50b1N0cmluZygpKTtcbiAgICAkKFwiI29wZW4tcm93MlwiKS50ZXh0KGxvd05vZGVTdGF0ZS5zbGljZSgzLCA2KS50b1N0cmluZygpKTtcbiAgICAkKFwiI29wZW4tcm93M1wiKS50ZXh0KGxvd05vZGVTdGF0ZS5zbGljZSg2LCA5KS50b1N0cmluZygpKTtcbn1cblxuZnVuY3Rpb24gcnVuQVN0YXJIMSgpOiBhbnkge1xuICAgIHN0YXJ0R2FtZSgpO1xuICAgIGxldCBzZXEgPSBqcXVlcnlFbGVtVG9OdW1TZXEocGllY2VzKTtcbiAgICBtZXRob2QgPSBuZXcgYVN0YXJIMShzZXEsIGN1cnJlbnRfYmxhbmspO1xuICAgIHNob3dJbmZvKCk7XG4gICAgYWRkQnV0dG9ucygpO1xuICAgICQoXCIjdGl0bGVcIikudGV4dChcIkHmmJ/nrpfms5UgSDFcIilcbn1cblxuZnVuY3Rpb24gcnVuQVN0YXJIMigpOiBhbnkge1xuICAgIHN0YXJ0R2FtZSgpO1xuICAgIGxldCBzZXEgPSBqcXVlcnlFbGVtVG9OdW1TZXEocGllY2VzKTtcbiAgICBtZXRob2QgPSBuZXcgYVN0YXJIMihzZXEsIGN1cnJlbnRfYmxhbmspO1xuICAgIHNob3dJbmZvKCk7XG4gICAgYWRkQnV0dG9ucygpO1xuICAgICQoXCIjdGl0bGVcIikudGV4dChcIkHmmJ/nrpfms5UgSDJcIilcbn1cblxuXG5mdW5jdGlvbiBqcXVlcnlFbGVtVG9OdW1TZXEoYXJyOiBhbnlbXSk6IG51bWJlcltdIHtcbiAgICBsZXQgcmVzdWx0OiBudW1iZXJbXSA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgOTsgaSsrKSB7XG4gICAgICAgIHZhciBjbGFzc05hbWUgPSBhcnJbaV0uYXR0cihcImNsYXNzXCIpO1xuICAgICAgICByZXN1bHQucHVzaChNYXRoLmFicyhjbGFzc05hbWUuc2xpY2UoY2xhc3NOYW1lLmxlbmd0aCAtIDIpKSk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG59XG5cbmZ1bmN0aW9uIGF1dG9SdW4oKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgZ29OZXh0KClcbiAgICB9IGNhdGNoIHsgcmV0dXJuOyB9XG4gICAgaWYgKHJ1blRpbWVvdXQgIT09IC0yKVxuICAgICAgICBzZXRUaW1lb3V0KGF1dG9SdW4sIDIpO1xufVxuXG5mdW5jdGlvbiBnb05leHQoKTogYW55IHtcbiAgICBpZiAobWV0aG9kLmNoZWNrUmVzdWx0KG1ldGhvZC5jdXJyZW50Tm9kZS5zdGF0ZSkpIHtcbiAgICAgICAgcnVuVGltZW91dCA9IC0yO1xuICAgICAgICAkKFwiI2J1dHRvbi1hcmVhXCIpLmFwcGVuZCgkKFwiPGJ1dHRvbj5cIikuXG4gICAgICAgIGF0dHIoXCJpZFwiLCBcInNob3dwYXRoXCIpLmFkZENsYXNzKFwiY2xpY2tcIikuXG4gICAgICAgIGNsaWNrKCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBsZXQgcGF0aCA9IG1ldGhvZC5wYXRoVG9DdXJyZW50O1xuICAgICAgICAgICAgY3VycmVudF9ibGFuayA9IHBhdGhbMF0uYmxhbmtJbmRleDtcbiAgICAgICAgICAgIHByaW50UGljdHVyZShwYXRoWzBdLnN0YXRlKTtcbiAgICAgICAgICAgIGxldCBpID0gMTtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gZGlzcGxheVBhdGgoKSB7XG4gICAgICAgICAgICAgICAgcGllY2VzW3BhdGhbaSsrXS5ibGFua0luZGV4XS5tb3ZlRnVuYygpO1xuICAgICAgICAgICAgICAgIGlmIChpIDwgcGF0aC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChkaXNwbGF5UGF0aCwgNTAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCA1MDApO1xuICAgICAgICB9KS50ZXh0KFwi5pi+56S66Lev5b6EXCIpKTtcbiAgICAgICAgJChcIiNuZXh0XCIpLnJlbW92ZSgpO1xuICAgICAgICAkKFwiI2F1dG9ydW5cIikucmVtb3ZlKCk7XG4gICAgICAgICQoXCIjcnVuLWFsbFwiKS5yZW1vdmUoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBsZXQgW25ld1NlcSwgbmV3QmxhbmtdID0gbWV0aG9kLm5leHQoKTtcbiAgICBzaG93SW5mbygpO1xuICAgIGN1cnJlbnRfYmxhbmsgPSBuZXdCbGFuaztcbiAgICBwcmludFBpY3R1cmUobmV3U2VxKTtcbiAgICBpZiAobWV0aG9kLmNoZWNrUmVzdWx0KG5ld1NlcSkpIHtcbiAgICAgICAgJChcIiNtZXNzYWdlXCIpLnRleHQoXCLmkJzntKLlrozmiJDjgILmraXmlbDvvJpcIittZXRob2Quc3RlcHMrXCIsIOi3r+W+hOmVv+W6pu+8mlwiK21ldGhvZC5wYXRoVG9DdXJyZW50Lmxlbmd0aCk7XG4gICAgfVxufVxuXG5cbmZ1bmN0aW9uIGFkZEJ1dHRvbnMoKSB7XG4gICAgJChcIiNidXR0b24tYXJlYVwiKS5hcHBlbmQoJChcIjxidXR0b24+XCIpLlxuICAgIGF0dHIoXCJpZFwiLCBcImF1dG9ydW5cIikuYWRkQ2xhc3MoXCJjbGlja1wiKS5cbiAgICBjbGljayggZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAocnVuVGltZW91dCAhPT0gLTIpIHtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChydW5UaW1lb3V0KTtcbiAgICAgICAgICAgIHJ1blRpbWVvdXQgPSAtMjtcbiAgICAgICAgICAgICQoXCIjbmV4dFwiKS5zaG93KCk7XG4gICAgICAgICAgICAkKFwiI3J1bi1hbGxcIikuc2hvdygpO1xuICAgICAgICAgICAgJCh0aGlzKS50ZXh0KFwi6Ieq5Yqo6L+Q6KGMXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcnVuVGltZW91dCA9IHNldFRpbWVvdXQoYXV0b1J1biwgMSk7XG4gICAgICAgICAgICAkKHRoaXMpLnRleHQoXCLmmoLlgZzov5DooYxcIik7XG4gICAgICAgICAgICAkKFwiI25leHRcIikuaGlkZSgpO1xuICAgICAgICAgICAgJChcIiNydW4tYWxsXCIpLmhpZGUoKTtcbiAgICAgICAgfVxuICAgIH0pLnRleHQoXCLoh6rliqjov5DooYxcIikpO1xuICAgICQoXCIjYnV0dG9uLWFyZWFcIikuYXBwZW5kKCQoXCI8YnV0dG9uPlwiKS5cbiAgICBhdHRyKFwiaWRcIiwgXCJydW4tYWxsXCIpLmFkZENsYXNzKFwiY2xpY2tcIikuXG4gICAgY2xpY2soIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbWV0aG9kLnJ1bkFsbCgpO1xuICAgICAgICBjdXJyZW50X2JsYW5rID0gbWV0aG9kLmN1cnJlbnROb2RlLmJsYW5rSW5kZXg7XG4gICAgICAgIHByaW50UGljdHVyZShtZXRob2QuY3VycmVudE5vZGUuc3RhdGUpO1xuICAgICAgICAkKFwiI21lc3NhZ2VcIikudGV4dChcIuaQnOe0ouWujOaIkOOAguatpeaVsO+8mlwiK21ldGhvZC5zdGVwcytcIiwg6Lev5b6E6ZW/5bqm77yaXCIrbWV0aG9kLnBhdGhUb0N1cnJlbnQubGVuZ3RoKTtcbiAgICAgICAgZ29OZXh0KCk7XG4gICAgICAgIHNob3dJbmZvKCk7XG4gICAgfSkudGV4dChcIuebtOaOpeaxguino1wiKSk7XG59XG5cbiJdfQ==